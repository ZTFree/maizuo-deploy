import{E as O,H as q,y as G}from"./base-ad0068b1.js";import{a as K}from"./el-main-3b59cf7c.js";/* empty css                */import{S as Q}from"./ScheduleDateList-a69cb1a2.js";import{_ as U}from"./LoadingMod-b2d8dc0e.js";import{F as W}from"./FilterMenu-5ee8f9fb.js";import{E as X,C as Y,c as Z}from"./el-overlay-b0c9ec09.js";import{_ as tt,u as at,a0 as et,$ as it,r as n,j as o,l as S,o as st,c as u,g as B,i as _,e as s,w as p,t as nt,d as E,J as ot,p as M,F as ct,h as rt}from"./index-35cb0dd4.js";import"./request-8cf98847.js";import{g as lt,a as ut}from"./city-05b4df96.js";import{b as mt,c as dt}from"./cinimas-19f5ddcc.js";import{g as ft}from"./film-1447790b.js";import"./el-button-7195a193.js";import"./el-input-5051ef1b.js";import"./dayjs.min-5433e12a.js";import"./focus-trap-bb38ce04.js";import"./index-e90ec287.js";import"./error-f1912ce6.js";import"./icon-56d47907.js";import"./size-a5a08e6d.js";import"./index-06758cc8.js";const _t={class:"film-cinemas-container"},pt={class:"nav-bar"},vt={style:{"font-size":"17px"}},gt={class:"cinimas-list"},ht={__name:"FilmCinemasPage",props:["fid"],setup(v){const{fid:g}=v,h=at(),w=et(),{setLocalInfo:y,getCoords:N,coords:C,curCityId:D}=w,{localInfo:m}=it(w),I=n(),i=n([]),c=n(),F=o(()=>i.value.length===0),P=o(()=>c.value?c.value.filterFields.ticketFlag+1:1);S(P,()=>{f()});const b=o(()=>{const t=new Set;return i.value.forEach(a=>{t.add(a.districtName)}),["全城",...t]});S(i,()=>{C.length&&i.value.forEach(t=>{t.__distance=Z(...C,t.latitude,t.longitude)})});const T=o(()=>{if(!c.value)return i.value;const{district:t}=c.value.filterFields;return i.value.filter(e=>e.districtName===t||t==="全城").sort((e,l)=>e.__distance-l.__distance)});function V(){h.back()}function $(){h.push({name:"search"})}async function j(){const t=await ft(g);I.value=t.data.data.film}const r=n(),d=n(-1),k=n(0);async function z(t,a){d.value=t,k.value=a,await f()}const J=o(()=>r.value?r.value.showCinemas.map(t=>t.showDate):[]);async function R(){const t=await mt({filmId:g,cityId:D});r.value=t.data.data,d.value=r.value.showCinemas[0].showDate}const A=o(()=>r.value.showCinemas.find(a=>a.showDate===d.value).cinemaList.join(","));async function f(){const t=JSON.stringify({cityId:D,cinemaIds:A.value}),a=await dt(t);i.value=a.data.data.cinemas}async function H(){const{data:{data:{city:t},status:a}}=await lt();a||await X.confirm(`定位到当前城市为${t.name},是否要切换至该城市?`,{confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{y(t)}).catch(async()=>{const{data:{data:{cities:e},status:l}}=await ut();l||y(e[0])})}return st(async()=>{await N(),m!=null&&m.value||await H(),await R(),await f(),await j()}),(t,a)=>{var x;const e=O,l=K;return u(),B("div",_t,[_("div",pt,[s(e,{size:"13px",onClick:V},{default:p(()=>[s(M(q))]),_:1}),_("span",vt,nt((x=I.value)==null?void 0:x.name),1),s(e,{onClick:$},{default:p(()=>[s(M(G))]),_:1})]),s(Q,{showDate:J.value,activeIndex:k.value,onClickItem:z},null,8,["showDate","activeIndex"]),s(W,{ref_key:"filterMenu",ref:c,list:b.value,isApp:!0},null,8,["list"]),s(l,{class:"cinimas-main"},{default:p(()=>[_("ul",gt,[(u(!0),B(ct,null,rt(T.value,L=>(u(),E(Y,{key:L.cinemaId,data:{...L,filmId:v.fid}},null,8,["data"]))),128))])]),_:1}),F.value?(u(),E(U,{key:0,flag:F.value,full:""},null,8,["flag"])):ot("",!0)])}}},Jt=tt(ht,[["__scopeId","data-v-38f6799a"]]);export{Jt as default};
