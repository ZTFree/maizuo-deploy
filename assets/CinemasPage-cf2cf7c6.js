import{p as V,y as $,E as z}from"./base-ad0068b1.js";/* empty css                  */import{E as R,c as b,a as j}from"./el-main-3b59cf7c.js";/* empty css                */import{_ as H}from"./LoadingMod-b2d8dc0e.js";import{F as J}from"./FilterMenu-5ee8f9fb.js";import{E as Y,C as q,c as A}from"./el-overlay-b0c9ec09.js";import{_ as G,u as K,a0 as O,$ as Q,r as k,j as c,l as x,o as U,c as d,d as _,w as l,e as n,i as m,Y as W,t as X,p as E,g as Z,h as tt,F as at,J as et,a1 as st,a2 as it}from"./index-35cb0dd4.js";import"./request-8cf98847.js";import{g as nt,a as ot}from"./city-05b4df96.js";import{g as rt}from"./cinimas-19f5ddcc.js";import"./el-button-7195a193.js";import"./el-input-5051ef1b.js";import"./focus-trap-bb38ce04.js";import"./index-e90ec287.js";import"./error-f1912ce6.js";import"./icon-56d47907.js";import"./size-a5a08e6d.js";import"./index-06758cc8.js";const ct=u=>(st("data-v-312d5daa"),u=u(),it(),u),lt={class:"nav-bar"},ut=ct(()=>m("span",null,"影院",-1)),dt={class:"cinimas-list"},mt={__name:"CinemasPage",setup(u){const p=K(),f=O(),{setLocalInfo:g,getCoords:S,coords:v,curCityId:F}=f,{localInfo:e}=Q(f),s=k([]),o=k(),h=c(()=>s.value.length===0),y=c(()=>o.value?o.value.filterFields.ticketFlag+1:1);x(y,()=>{C()});const L=c(()=>{const t=new Set;return s.value.forEach(i=>{t.add(i.districtName)}),["全城",...t]});x(s,()=>{v.length&&s.value.forEach(t=>{t.__distance=A(...v,t.latitude,t.longitude)})});const I=c(()=>{if(!o.value)return s.value;const{district:t}=o.value.filterFields;return s.value.filter(a=>a.districtName===t||t==="全城").sort((a,r)=>a.__distance-r.__distance)}),B=c(()=>{var t;return(t=e==null?void 0:e.value)!=null&&t.name?e.value.name:"未知"});function D(){p.push({name:"city"})}function N(){p.push({name:"search"})}async function C(){const{data:{data:{cinemas:t},status:i}}=await rt({cityId:F,ticketFlag:y.value});i||(s.value=t)}async function M(){const{data:{data:{city:t},status:i}}=await nt();i||await Y.confirm(`定位到当前城市为${t.name},是否要切换至该城市?`,{confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{g(t)}).catch(async()=>{const{data:{data:{cities:a},status:r}}=await ot();r||g(a[0])})}return U(async()=>{await S(),e!=null&&e.value||await M(),await C()}),(t,i)=>{const a=z,r=b,P=j,T=R;return d(),_(T,{class:"cinimas-container"},{default:l(()=>[n(r,{height:"auto",class:"cinimas-top"},{default:l(()=>[m("div",lt,[m("div",{onClick:D,style:{"font-size":"13px"}},[W(X(B.value)+" ",1),n(a,{size:"10px"},{default:l(()=>[n(E(V))]),_:1})]),ut,n(a,{onClick:N},{default:l(()=>[n(E($))]),_:1})]),n(J,{ref_key:"filterMenu",ref:o,list:L.value},null,8,["list"])]),_:1}),n(P,{class:"cinimas-main"},{default:l(()=>[m("ul",dt,[(d(!0),Z(at,null,tt(I.value,w=>(d(),_(q,{key:w.cinemaId,data:w},null,8,["data"]))),128))])]),_:1}),h.value?(d(),_(H,{key:0,flag:h.value,full:""},null,8,["flag"])):et("",!0)]),_:1})}}},Mt=G(mt,[["__scopeId","data-v-312d5daa"]]);export{Mt as default};
