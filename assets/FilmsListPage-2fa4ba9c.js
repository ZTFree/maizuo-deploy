import{_ as x,j as k,u as B,c as l,g as d,i as s,t as r,J as p,e as L,w as C,Y as I,Z as S,r as h,S as $,a as F,$ as N,a0 as P,l as R,C as T,M as V,F as z,h as D,d as w,p as E}from"./index-35cb0dd4.js";import"./base-ad0068b1.js";import{E as j}from"./el-button-7195a193.js";import{d as A}from"./dayjs.min-5433e12a.js";import{_ as H}from"./LoadingMod-b2d8dc0e.js";import{i as M}from"./request-8cf98847.js";import"./index-06758cc8.js";import"./icon-56d47907.js";import"./index-e90ec287.js";import"./size-a5a08e6d.js";const q={class:"imgBox"},J=["src"],Q={class:"mainBox"},X={class:"film-title"},Y={class:"film-name line-overflow"},Z={class:"film-type"},G={key:0},K={key:0},O={style:{color:"#fcb13c","margin-left":"4px"}},U={class:"actors-line line-overflow"},W={key:1},ee={key:2},te={class:"buy-btn"},ae={__name:"ListItem",props:["data","type"],setup(t){const{data:o,type:c}=t,n=k(()=>c==="nowPlaying"),y=k(()=>{const a=A(o.premiereAt);let e="";switch(a.day()){case 0:e="日";break;case 1:e="一";break;case 2:e="二";break;case 3:e="三";break;case 4:e="四";break;case 5:e="五";break;case 6:e="六";break}return`周${e} ${a.month()+1}月${a.date()}日`}),_=k(()=>{var a;return(a=o==null?void 0:o.actors)==null?void 0:a.reduce((e,i)=>e+" "+i.name,"")}),g=B();function v(a){g.push({name:"film",params:{fid:a}})}function u(a){g.push({name:"film-cinimas",params:{fid:a}})}return(a,e)=>{const i=j;return t.data?(l(),d("div",{key:0,class:"itemContainer",onClick:e[1]||(e[1]=m=>v(t.data.filmId))},[s("div",q,[s("img",{src:t.data.poster},null,8,J)]),s("div",Q,[s("div",X,[s("p",Y,r(t.data.name),1),s("i",Z,r(t.data.filmType.name),1)]),n.value?(l(),d("div",G,[s("div",null,[t.data.grade?(l(),d("span",K," 观众评分")):p("",!0),s("span",O,r(t.data.grade),1)])])):p("",!0),s("div",U,"主演:"+r(_.value),1),n.value?p("",!0):(l(),d("div",W,"上映时间: "+r(y.value),1)),n.value?(l(),d("div",ee,r(t.data.nation)+"|"+r(t.data.runtime)+"分钟",1)):p("",!0)]),s("div",te,[L(i,{size:"small",color:n.value?"#fb5e1e":"#fcb13c",plain:"",onClick:e[0]||(e[0]=S(m=>u(t.data.filmId),["stop"]))},{default:C(()=>[I(r(n.value?"购票":"预购"),1)]),_:1},8,["color"])])])):p("",!0)}}},se=x(ae,[["__scopeId","data-v-49a14111"]]),oe=t=>M.get("",{params:t,headers:{"X-Host":"mall.film-ticket.film.list"}});const ie={class:"list-body"},ne={key:1,class:"is-all-show"},le={__name:"FilmsListPage",setup(t){const o=h([]),c=$({cityId:"",pageNum:1,pageSize:10,type:1}),n=h(!1);async function y(){const{data:{data:{films:i},status:m}}=await oe(c);m||(o.value=[...o.value,...i],u.value=!1,i.length<c.pageSize&&(n.value=!0))}const _=F(),{curCityId:g}=N(P());R(_,()=>{const i=_.name;c.pageNum=1,c.type=i==="nowPlaying"?1:2,c.cityId=g,n.value=!1,o.value=[],y()},{immediate:!0});const v=h(),u=h(!1);function a(){var f,b;if(n.value)return;const i=(f=v.value)==null?void 0:f.getBoundingClientRect().top,m=(b=v.value)==null?void 0:b.parentNode.getBoundingClientRect().bottom;i<m&&!u.value&&(u.value=!0,c.pageNum++,y())}const e=k(()=>o.value.length===0||u.value);return(i,m)=>(l(),d("div",{class:"list-container",onScroll:a},[T(s("div",ie,[(l(!0),d(z,null,D(o.value,f=>(l(),w(se,{key:f.filmId,data:f,type:E(_).name},null,8,["data","type"]))),128))],512),[[V,o.value.length]]),s("div",{ref_key:"bottomBox",ref:v},[n.value?(l(),d("div",ne,"- 无更多电影 -")):(l(),w(H,{key:0,flag:e.value},null,8,["flag"]))],512)],32))}},ge=x(le,[["__scopeId","data-v-dc70245d"]]);export{ge as default};
